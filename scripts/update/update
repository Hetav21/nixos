#!/run/current-system/sw/bin/sh
# NixOS Update Manager
# Convenience script to run different types of updates

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

# Function to show usage
show_usage() {
    echo "Usage: $0 [COMMAND] [ARGS...]"
    echo ""
    echo "Commands:"
    echo "  packages [inputs]     - Update packages from packages.conf"
    echo "  latest [inputs]       - Update latest flake inputs (nixpkgs-unstable, etc.)"
    echo "  standard [inputs]     - Update standard flake inputs (stylix, home-manager, etc.)"
    echo "  all [latest] [std]    - Update both packages and all flake inputs"
    echo "  help                  - Show this help message"
    echo ""
    echo "Examples:"
    echo "  scripts/update/update packages"
    echo "  scripts/update/update latest 'nixpkgs-unstable nixpkgs-master'"
    echo "  scripts/update/update standard 'stylix home-manager'"
    echo "  scripts/update/update all 'nixpkgs-unstable' 'stylix home-manager'"
    echo ""
    echo "Note: Inputs are passed as command line arguments from flake.nix settings"
}

# Main function
main() {
    local command="$1"
    shift 2>/dev/null || true  # Remove first argument and shift remaining
    
    case "$command" in
        "packages")
            "$SCRIPT_DIR/packages.sh" "$@"
            ;;
        "latest")
            "$SCRIPT_DIR/latest.sh" "$@"
            ;;
        "standard")
            "$SCRIPT_DIR/standard.sh" "$@"
            ;;
        "all")
            "$SCRIPT_DIR/all.sh" "$@"
            ;;
        "help"|"-h"|"--help"|"")
            show_usage
            ;;
        *)
            echo "Error: Unknown command '$command'"
            echo ""
            show_usage
            exit 1
            ;;
    esac
}

# Run main function
main "$@"